!function(){"use strict";var __registryType,__modulename="registry_manager",__pluginname="RegistryManager",__version=[0,1,1],__description="A simple tool to help save game information in a cleaner format instead of the game object that can be accessed anywhere in the game. Also helps with saving the data to the localstorage, cookies, or to a RESTful API.",__author="Joel Dies <phreaknation@gmail.com>",__registryname="GameRegistry",__confirmedDestroy=!1,__registers={NONE:{name:"NONE",functions:{}}},__registry={},__schemas={},REGISTRY_TYPES={NONE:0},plugin=function(game,parent){return Phaser.Plugin.call(this,game,parent),"undefined"==typeof console.error&&(console.error=console.log),this.game=game,this.parent=parent,this.schemas=__schemas,this.REGISTRY_TYPES=REGISTRY_TYPES,this};plugin.prototype=Object.create(Phaser.Plugin.prototype),plugin.prototype.constructor=Phaser.Plugin.SamplePlugin,__schemas.config={$schema:"http://json-schema.org/draft-04/schema#",title:"restConfig",description:"RESTful API config pattern",type:"object",properties:{method:{type:"number",minimum:0,maximum:1},urls:{type:"object",properties:{save:{type:"string"},load:{type:"string"},remove:{type:"string"}}},callback:{type:"object",properties:{save:{type:"function"},load:{type:"function"},remove:{type:"function"}}}}},plugin.prototype.addRegistryType=function(regType){return!!_.isUndefined(REGISTRY_TYPES[regType.name])&&(REGISTRY_TYPES[regType.name]=REGISTRY_TYPES.length,__registers[regType.name]=regType,!0)},plugin.prototype.allowDestroy=function(confirmed){var __funcname="allowDestroy";return _.isBoolean(confirmed)?(__confirmedDestroy=confirmed,__registryname):(console.error("[%s][%s] `%s` is not a boolean.",__modulename,__funcname,confirmed),!1)},plugin.prototype.description=function(){return _.toTitleCase(_.replace(__modulename,/\_/g," "))+" plugin by "+__author+". "+__description},plugin.prototype.destroyRegistry=function(accepted){if(accepted===!0&&__confirmedDestroy===!0){var register=plugin.prototype.getResgister(__registryType);return register.functions.remove.apply(register,[name]),!0}return!1},plugin.prototype.get=function(path){return _.isUndefined(path)&&(path="*"),!!_.isString(path)&&("*"===path?__registry:window.objectPath.get(__registry,path))},plugin.prototype.getRegistryTypes=function(){return Object.keys(REGISTRY_TYPES)},plugin.prototype.getResgister=function(type){var registerName=Object.keys(__registers)[type];return __registers[registerName]},plugin.prototype.load=function(name){var data={};_.isString(name)&&this.setRegistryName(name),name=__registryname;var register=plugin.prototype.getResgister(__registryType);return register.functions.load.apply(this,[name,data]),!0},plugin.prototype.parseData=function(strData){var __funcname="parseData";if(!_.isString(strData))return console.error("[%s][%s] Data being passed is not a string.",__modulename,__funcname),!1;var data=JSON.parse(strData||"{}");return _.isObject(data)?data:(console.error("[%s][%s] Data is not an object. Possibly overwritten by an outside source.",__modulename,__funcname),!1)},plugin.prototype.remove=function(path){if(!_.isUndefined(path)&&_.isString(path))return window.objectPath.del(__registry,path)},plugin.prototype.save=function(){var data=JSON.stringify(__registry),register=plugin.prototype.getResgister(__registryType);return register.functions.save.apply(register,[__registry,name,data])},plugin.prototype.set=function(path,value){if(!_.isUndefined(path)&&!_.isUndefined(value))return window.objectPath.set(__registry,path,value),__registry},plugin.prototype.setData=function(data){var __funcname="setData";return _.isObject(data)?__registry=data:(console.error("[%s][%s] Data is not an object. Possibly overwritten by an outside source.",__modulename,__funcname),!1)},plugin.prototype.setRegistry=function(type){var __funcname="setRegistry";if(type=parseInt(type)||2,"string"==typeof type)"undefined"!=typeof REGISTRY_TYPES[type]?__registryType=REGISTRY_TYPES[type]:console.error("[%s][%s] `%s` is not a known registry type.",__modulename,__funcname,type);else if("number"==typeof type){var len=Object.keys(REGISTRY_TYPES).length-1;if(type<=len)return __registryType=type,!0;console.error("[%s][%s] `%s` is not a known registry type.",__modulename,__funcname,type)}else console.error("[%s][%s] The `type` argument supplied is not a string or number.",__modulename,__funcname);return!1},plugin.prototype.setRegistryName=function(name){var __funcname="setRegistryName";return _.isString(name)?__registryname=name:(console.error("[%s][%s] `%s` is not a string.",__modulename,__funcname,name),!1)},plugin.prototype.version=function(){return __version.join(".")};var __cacheDays=365,loadCookie=function(name){for(var nameEQ=name+"=",ca=document.cookie.split(";"),i=0;i<ca.length;i++){for(var c=ca[i];" "==c.charAt(0);)c=c.substring(1,c.length);if(0===c.indexOf(nameEQ)){var data=this.parseData(c.substring(nameEQ.length,c.length));if(_.isObject(data))return this.setData(data)}}return null},removeCookie=function(name){loadCookie(name,"{}",-1)},saveCookie=function(name,data){var expires="";if(__cacheDays){var date=new Date;date.setTime(date.getTime()+24*__cacheDays*60*60*1e3),expires="; expires="+date.toUTCString()}document.cookie=name+"="+data+expires+"; path=/"};plugin.prototype.setCacheLengthInDays=function(days){var __funcname="setCacheLengthInDays";return _.isNumber(days)?__cacheDays=parseInt(days):(console.error("[%s][%s] `%s` is not a number.",__modulename,__funcname,days),!1)},plugin.prototype.addRegistryType({name:"COOKIES",functions:{load:loadCookie,remove:removeCookie,save:saveCookie}}),plugin.prototype.isLocalStorageSupported=function(){try{if("object"==typeof localStorage)return localStorage.setItem("testingLocalStorage","foo"),localStorage.removeItem("testingLocalStorage"),!0}catch(e){return!1}return!1};var loadLS=function(name){if(console.log(this),_.isString(name)){var ls=localStorage.getItem(name);if(!_.isNull(ls)){var data=this.parseData(localStorage.getItem(name));if(_.isObject(data))return this.setData(data)}}},removeLS=function(name){localStorage.setItem(name,"{}")},saveLS=function(name,data){if(_.isString(name)&&_.isString(name))return console.log(name,data),localStorage.setItem(name,data)};plugin.prototype.addRegistryType({name:"LOCALSTORAGE",functions:{load:loadLS,remove:removeLS,save:saveLS}});var RESTAPI_METHODS={GET:0,POST:1},__restapi={method:RESTAPI_METHODS.POST,urls:{save:"/api/save/{registryname}",load:"/api/load/{registryname}",remove:"/api/delete/{registryname}"},callback:{}};plugin.RESTAPI_METHODS=RESTAPI_METHODS,plugin.prototype.configREST=function(config){var __funcname="configREST";if(_.isObject(config)){var valid=ajv.validate(this.schemas.config,config);valid?__restapi=_.merge(__restapi,config):console.error("[%s][%s] `%s` is not an object.",__modulename,__funcname,config)}return!1};var loadREST=function(callback){var __funcname="loadREST";if(!_.isString(__restapi.urls.load))return console.error("[%s][%s] The restful API is not properly configured: `%s`.",__modulename,__funcname,__restapi.urls.load),!1;var URL=_.format(__restapi.urls.load,{registryname:__registryname});_.callURL({URL:URL,callback:function(resp,status){if(_.isString(resp))var data=this.parseData(resp);return _.isObject(data)?this.setData(data):(_.isFunction(__restapi.callback.load)&&__restapi.callback.load(data,status),data)}})},removeREST=function(callback){var __funcname="removeREST";if(!_.isString(__restapi.urls.remove))return console.error("[%s][%s] The restful API is not properly configured: `%s`.",__modulename,__funcname,__restapi.urls.remove),!1;var URL=_.format(__restapi.urls.load,{registryname:__registryname});_.callURL({URL:URL,callback:function(resp,status){_.isString(resp)&&"true"===resp&&_.isFunction(__restapi.callback.load)&&__restapi.callback.remove(data,status)}})},saveREST=function(data,callback){var __funcname="saveREST";if(!_.isString(__restapi.urls.save))return console.error("[%s][%s] The restful API is not properly configured: `%s`.",__modulename,__funcname,__restapi.urls.save),!1;if(!_.isString(data))return console.error("[%s][%s] Data provided is not a string: `%s`.",__modulename,__funcname,typeof data),!1;var URL=_.format(__restapi.urls.save,{registryname:__registryname});_.callURL({URL:URL,data:data,callback:function(resp,status){var data;return _.isString(resp)&&!_.empty(resp)&&(data=this.parseData(resp)),!!_.isObject(data)&&(data=this.setData(data),void(_.isObject(data)&&_.isFunction(__restapi.callback.load)&&__restapi.callback.load(data,status)))}})};plugin.prototype.addRegistryType({name:"RESTFUL_API",functions:{load:loadREST,remove:removeREST,save:saveREST}}),window.PhreakNation=window.PhreakNation||{},window.PhreakNation.Plugins=window.PhreakNation.Plugins||{},window.PhreakNation.Plugins[__pluginname]=plugin}();